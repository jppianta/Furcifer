<!DOCTYPE html>
<html>

<head>
  <script type="text/javascript">
    // set the pyodide files URL (packages.json, pyodide.asm.data etc)
    window.languagePluginUrl = window.location.origin + '/pyodide/';
  </script>
</head>

<body>
  <script type='module' src="./furcifer.js"></script>
  <script defer type="text/javascript">
    var waitForGlobal = function (key, callback) {
      if (window[key]) {
        callback();
      } else {
        setTimeout(function () {
          waitForGlobal(key, callback);
        }, 100);
      }
    };
    const valSpan = document.getElementById('valSpan');
    const incButton = document.getElementById('inc');
    const decButton = document.getElementById('dec');

    waitForGlobal("loaded", function () {
      loaded.then(() => {
        pyodide.runPython('import sys');
        pyodide.runPython('sys.path.append("/lib/python3.7/site-packages/test")');
        pyodide.runPython('import test');
        const test = pyodide.pyimport('test')

        const valSpan = document.getElementById('valSpan');
        const incButton = document.getElementById('inc');
        const decButton = document.getElementById('dec');

        valSpan.innerHTML = test.val;
        incButton.onclick = () => {
          test.incVal();
          valSpan.innerHTML = test.val;
        }
        decButton.onclick = () => {
          test.decVal();
          valSpan.innerHTML = test.val;
        }
      });
    });
  </script>
  <h1>Furcifer Test Page</h1>

  <span id='valSpan'>0</span>
  <button id='inc'>+</button>
  <button id='dec'>-</button>
</body>